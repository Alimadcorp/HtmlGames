<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Signup Page</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          fontFamily: {
            sans: ["Geist", "ui-sans", "system-ui"],
            mono: ["GeistMono", "ui-monospace", "monospace"],
            bold: ["Geist", "ui-sans-serif", "system-ui"],
            title: ["GeistMono", "ui-monospace", "monospace"],
          },
          fontWeight: {
            sans: 'normal',
            mono: 'normal',
            bold: 'bold',
            title: 'bold',
          },
          colors: {
            theme: "#2563eb"
          },
        },
      },
    };
  </script>
  <style type="text/tailwindcss">
    @layer base {
      body {
        user-select: none;
        overflow-x: hidden;
        -webkit-tap-highlight-color: transparent;
      }
      .emoji img {
        @apply inline-block align-middle;
        height: 1.5em;
        width: auto;
        transform-origin: center;
      }
      .anchor {
        @apply text-blue-400 hover:underline cursor-pointer inline
      }
      button, input {
        @apply transition-all duration-300 ease-in-out;
      }
      button:disabled {
        opacity: .5;
        color: #6b7280;
        background-color: #38393b;
        cursor: not-allowed;
      }
      input:disabled {
        opacity: .5;
        background: #38393b;
        color: #9da8bd;
        border: 2px solid #9da8bd;
        cursor: not-allowed;
      }
      .toast {
        opacity: 0;
        border: 0.15em solid #fff4;
        border-radius: 0.5em;
        backdrop-filter: blur(5px) brightness(1.5);
        transform: translateY(20px) scale(.95);
        transition: .25s ease;
      }
      .toast.show {
        opacity: 1;
        transform: translateY(0) scale(1);
      }
      .toast.hide {
        opacity: 0;
        transform: translateY(10px) scale(.9);
      }
      .toast-close {
        position: absolute;
        top: -6px;
        right: -6px;
        width: 18px;
        height: 18px;
        border-radius: 999px;
        display: flex;
        align-items: center;
        justify-content: center;
        background: #0005;
        backdrop-filter: blur(4px);
        cursor: pointer;
      }
    }
  </style>
  <style>
    @font-face {
      font-family: "Geist";
      src: url("https://proxy.alimad.co/api/proxy?url=https://cdn.alimad.co/f/geist.woff2") format("woff2");
      font-weight: normal, bold;
      font-style: normal;
    }
    @font-face {
      font-family: "GeistMono";
      src: url("https://proxy.alimad.co/api/proxy?url=https://cdn.alimad.co/f/GeistMono.woff2") format("woff2");
      font-weight: normal, bold;
      font-style: normal;
    }
  </style>
</head>
<body class="bg-gradient-to-br from-[#002033] to-black flex items-center justify-center min-h-screen font-sans">
  <div class="bg-white/10 backdrop-blur-lg rounded-2xl p-6 sm:p-8 w-full max-w-md mx-4 sm:mx-auto shadow-lg flex flex-col gap-6 my-10">
    <h1 class="flex flex-wrap-nowrap items-center justify-center text-white font-title whitespace-nowrap text-[clamp(1rem,3vw,2rem)] md:text-[1.3rem]">
      <span id="titl" class="flex-shrink-0">Sign Up for&nbsp;</span>
      <span class="flex-shrink-0">TheCloudServices™</span>
    </h1>
    <hr class="opacity-30">
    <form class="flex flex-col gap-4" id="form1" style='display:flex'>
      <p class="text-gray-500 text-sm text-center">Enter email address</p>
      <input required type="email" placeholder="Email" id="email" 
        class="transition-all p-3 rounded-lg bg-white/10 placeholder-white text-white focus:ring-2 focus:ring-blue-500 outline-none text-sm sm:text-base" />
      <input type="password" placeholder="Password" id='password' style="display:none"
        class="transition-all p-3 rounded-lg bg-white/10 placeholder-white text-white focus:ring-2 focus:ring-blue-500 outline-none text-sm sm:text-base" />
      <button id="create1" type="submit" disabled
        class="bg-blue-600 hover:brightness-120 text-white font-bold py-3 rounded-lg transition-all flex items-center justify-center text-sm sm:text-base">
        Create Account
      </button>
    </form>
    <form class="flex flex-col gap-4" id="form3" style='display:none'>
      <p class="text-gray-500 text-sm text-center">Step 2: Enter your name</p>
      <input id="name1" placeholder="First name" required data-key="first"
      class="transition-all p-3 rounded-lg bg-white/10 placeholder-white text-white focus:ring-2 focus:ring-blue-500 outline-none text-sm sm:text-base h-12 disabled:text-white disabled:opacity-100">
      <input id="name2" placeholder="Middle name" required data-key="middle"
      class="hidden transition-all p-3 rounded-lg bg-white/10 placeholder-white text-white focus:ring-2 focus:ring-blue-500 outline-none text-sm sm:text-base h-12 disabled:text-white disabled:opacity-100">
      <input id="name3" placeholder="Second middle name" required data-key="second-middle"
      class="hidden transition-all p-3 rounded-lg bg-white/10 placeholder-white text-white focus:ring-2 focus:ring-blue-500 outline-none text-sm sm:text-base h-12 disabled:text-white disabled:opacity-100">
      <input id="name4" placeholder="Nickname" required data-key="nick"
      class="hidden transition-all p-3 rounded-lg bg-white/10 placeholder-white text-white focus:ring-2 focus:ring-blue-500 outline-none text-sm sm:text-base h-12 disabled:text-white disabled:opacity-100">
      <input id="name5" placeholder="Preferred name" required data-key="preferred"
      class="hidden transition-all p-3 rounded-lg bg-white/10 placeholder-white text-white focus:ring-2 focus:ring-blue-500 outline-none text-sm sm:text-base h-12 disabled:text-white disabled:opacity-100">
      <input id="name6" placeholder="Maiden name" required data-key="maiden"
      class="hidden transition-all p-3 rounded-lg bg-white/10 placeholder-white text-white focus:ring-2 focus:ring-blue-500 outline-none text-sm sm:text-base h-12 disabled:text-white disabled:opacity-100">
      <input id="name7" placeholder="Birth name" required data-key="birth"
      class="hidden transition-all p-3 rounded-lg bg-white/10 placeholder-white text-white focus:ring-2 focus:ring-blue-500 outline-none text-sm sm:text-base h-12 disabled:text-white disabled:opacity-100">
      <input id="name8" placeholder="Honorific title" required data-key="title"
      class="hidden transition-all p-3 rounded-lg bg-white/10 placeholder-white text-white focus:ring-2 focus:ring-blue-500 outline-none text-sm sm:text-base h-12 disabled:text-white disabled:opacity-100">
      <input id="name9" placeholder="Suffix" required data-key="suffix"
      class="hidden transition-all p-3 rounded-lg bg-white/10 placeholder-white text-white focus:ring-2 focus:ring-blue-500 outline-none text-sm sm:text-base h-12 disabled:text-white disabled:opacity-100">
      <input id="name10" placeholder="Pen name" required data-key="pen"
      class="hidden transition-all p-3 rounded-lg bg-white/10 placeholder-white text-white focus:ring-2 focus:ring-blue-500 outline-none text-sm sm:text-base h-12 disabled:text-white disabled:opacity-100">
      <input id="name11" placeholder="Name of favourite personality" required data-key="personality"
      class="hidden transition-all p-3 rounded-lg bg-white/10 placeholder-white text-white focus:ring-2 focus:ring-blue-500 outline-none text-sm sm:text-base h-12 disabled:text-white disabled:opacity-100">
      <input id="name12" placeholder="Name of your father's father" required data-key="grandfather"
      class="hidden transition-all p-3 rounded-lg bg-white/10 placeholder-white text-white focus:ring-2 focus:ring-blue-500 outline-none text-sm sm:text-base h-12 disabled:text-white disabled:opacity-100">
      <input id="name13" placeholder="Name of the guy who lives next door" required data-key="neighbour"
      class="hidden transition-all p-3 rounded-lg bg-white/10 placeholder-white text-white focus:ring-2 focus:ring-blue-500 outline-none text-sm sm:text-base h-12 disabled:text-white disabled:opacity-100">
      <input id="name14" placeholder="Last name" required data-key="last"
      class="hidden transition-all p-3 rounded-lg bg-white/10 placeholder-white text-white focus:ring-2 focus:ring-blue-500 outline-none text-sm sm:text-base h-12 disabled:text-white disabled:opacity-100">
      <button id="create3" type="submit" disabled
        class="bg-blue-600 hover:brightness-120 text-white font-bold py-3 rounded-lg transition-all flex items-center justify-center text-sm sm:text-base">
        Next
      </button>
    </form>
    <form class="flex flex-col gap-4" id="form2" style='display:none'>
      <p class="text-gray-500 text-sm text-center">Step 3: Select a username</p>
      <input id="username" placeholder="Username" required disabled
        class="transition-all p-3 rounded-lg bg-white/10 placeholder-white text-white focus:ring-2 focus:ring-blue-500 outline-none text-sm sm:text-base h-12 disabled:text-white disabled:opacity-100">
        <div class="flex items-center gap-0 justify-center text-white">
          <div id="rot1" class="px-2 text-3xl font-title cursor-pointer hover:bg-[#ffffff22] rounded-md">a</div>
          <div id="rot2" class="px-2 text-3xl font-title cursor-pointer hover:bg-[#ffffff22] rounded-md">j</div>
          <div id="rot3" class="px-2 text-3xl font-title cursor-pointer hover:bg-[#ffffff22] rounded-md">s</div>
          <div id="rot4" class="px-2 text-3xl font-title cursor-pointer hover:bg-[#ffffff22] rounded-md">1</div>
          <div id="back" class="mx-2 px-3 py-1.5 bg-blue-600 rounded-lg active:scale-95 hover:bg-blue-500 transition cursor-pointer">←</div>
        </div>
      <button id="create2" type="submit" disabled
        class="bg-blue-600 hover:brightness-120 text-white font-bold py-3 rounded-lg transition-all flex items-center justify-center text-sm sm:text-base">
        Next
      </button>
    </form>
    <p id="login" class="text-white/70 text-center text-xs sm:text-sm">
      Already have an account? 
      <span onclick="login()" class="text-blue-400 hover:underline anchor">Log in</span>
    </p>
  </div>
  <div id="toasts" class="fixed bottom-4 right-4 flex flex-col gap-2 z-50"></div>
  <script src="https://cdn.jsdelivr.net/npm/lucide@0.553.0/dist/umd/lucide.min.js"></script>
  <script>

    // ----------------------- UTILITY -----------------------

    const a = e => requestAnimationFrame(e);
    const g = (e) => document.getElementById(e);
    const q = (e) => document.querySelectorAll(e);
    const l = lucide.createIcons;
    const ord = (n) => { const s = ["th","st","nd","rd"], v = n % 100; return n + (s[(v-20)%10] || s[v] || s[0]) };
    const pre = (e, t) => t.map(str => e + str);
    const del = (k) => localStorage.removeItem(k);
    const exec = (f, t) => setTimeout(f, t);
    const fetc = async (x,o) => {let r,t,b,e;x=typeof x=="string"?[x]:x;for(let u of x){try{r=await fetch(u,o);if(!r.ok)throw r;t=await r.text();try{b=JSON.parse(t)}catch{b=t}return b}catch(er){e=er}}return e};
    const load = (k, d = 0) => { let w = localStorage.getItem(k); if(!w) return d; try { return JSON.parse(w) } catch { return /^\d+$/.test(w) ? parseInt(w):w }};
    const save = (k, e) => localStorage.setItem(k, typeof e == 'string' ? e : JSON.stringify(e));
    const titl = s => s.replace(/\w\S*/g, w => w[0].toUpperCase() + w.slice(1).toLowerCase());
    const rick = () => window.open("https://cdn.alimad.co/f/static/Ricky.mp4", '_self');
    const shuf = (s) => [...s].sort(()=>Math.random()-0.5).join('');
    
    // ----------------------- GLOBAL VARIABLES -----------------------

    let state = { create1att: 0 };
    const chars = 'abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789()-_.';

    // ----------------------- INITIAL LOGIC -----------------------

    const seqs = { rot1: "abcdefghi", rot2: "jklmnopqr", rot3: "stuvwxyz_", rot4: "1234567890"};
    for (let id in seqs) {
      state[id] = 0;
      setInterval(() => {
        let s = seqs[id];
        state[id] = (state[id] + 1) % s.length;
        document.getElementById(id).textContent = s[state[id]];
      }, 400);
    }
    for (let id in seqs) {
      document.getElementById(id).onclick = () => {
        g('username').value += document.getElementById(id).textContent;
        g('create2').disabled = g('username').value.length < 4;
      };
    }
    back.onclick = () => { let u = g('username'); u.value = u.value.slice(0, -1); g('create2').disabled = g('username').value.length < 4; };

    for(let i = 1; i <= 13; i++){
      g('name'+i).addEventListener('input', e => g('name'+(i+1)).style.display = (g('name'+i).value.length > 2) ? 'inline' : 'none');
    }

    function login() { // On click 'Log in instead'
      let i = g('login').innerHTML; save('lih', i);
      let att = load('login.attempts'); let lo = load('login.loop');
      let o, xs, d = 2000;
      switch(att){
        case 0: o = "Bro you don't have an account yet"; break
        case 1: o = "I said bro you don't even have an account yet"; break
        case 2: o = "Look, you need to sign up first, before trying to login"; break
        case 3: o = "Do you even remember your username?"; break
        case 4: o = "Are you sure?"; break
        case 5: o = "Stop lying, I can see all accounts"; break
        case 6: o = "Oh god please just follow the steps above"; break
        case 7: o = "What are you on in for <span class='emoji'>:heavysob:</span>"; break
        case 8: o = "SIGN UP BEFORE TRYING TO LOG IN"; break
        case 9: o = "<p class='font-bold'>YOU HAVE NO ACCOUNT TO LOG IN TO YET</p>"; break
        case 10: o = "<p class='gibberish font-bold'>123456789012345678901234567890</p>"; break
        case 11: o = "<span class='emoji'>:noooovanish:</span> ".repeat(10); break
        case 12: o = "<span class='emoji'>:heavysob-random:</span> ".repeat(15); if(lo > 0) o = `Bro this is your ${titl(ord(lo+1))} time doing this <span class='emoji'>:heavysob:</span>`; break
        case 13: o = "Fine, you won"; xs = "Here you go: "; save('login.loop', lo + 1); break
        case 14: o = "Bro has memory loss"; break;
        case 15: o = "BRO WHAT THE HELL DO YOU WANNA GO AGAIN"; break
        case 16: o = "Fine"; break
        default: o = "<span class='emoji'>:heavysob:</span>"; att = -1; break
      }
      g('login').innerHTML = o;
      emojify();
      save('login.attempts', att + 1);
      if(!xs) exec(() => g('login').innerHTML = i, d);
      else exec(() => { g('login').innerHTML = xs; exec(() => { g('create1').textContent = "Log In"; g('login').innerHTML = "Don't have an account? <span class='anchor' onclick=\"this.style.display = 'none'\">Sign up</span>"; g('password').style.display = 'inline'; g('password').required = true; g('titl').innerHTML = "Log In to&nbsp;"; save('login.attempts', 999) }, d) }, d);
    }
    function signup() {
      const el = g('create1');
      const orig = el.dataset.orig ?? (el.dataset.orig = el.innerHTML);
      const d = 2000;
      state.create1att = state.create1att || 0;
      if (state.create1att === 0) {
        el.innerHTML = 'Are you sure?';
        state.create1att = 1;
        clearTimeout(state._create1Revert);
        state._create1Revert = exec(() => { el.innerHTML = orig; state.create1att = 0; state._create1Revert = null; }, d);
        return;
      }
      if (state.create1att === 1) {
        state.create1att = 2;
        clearTimeout(state._create1Revert);
        el.setAttribute('disabled', '');
        el.style.pointerEvents = 'none';
        el.innerHTML = 'Loading...<div style="margin-top:8px;height:6px;background:#222;border-radius:6px;overflow:hidden"><div class="__fill" style="width:0%;height:100%"></div></div>';
        clearInterval(state._create1Timer);
        let p = 0;
        state._create1Timer = setInterval(() => {
          p = Math.min(100, p + (Math.random() * 12 + 6));
          const fill = el.querySelector('.__fill');
          if (fill) fill.style.width = p + '%';
          if (p >= 100) {
            clearInterval(state._create1Timer);
            state._create1Timer = null;
            el.innerHTML = '<i data-lucide="loader" class="w-6 h-6 text-white animate-spin" aria-hidden="true"></i>'; l();
            exec(() => { el.removeAttribute('disabled'); el.style.pointerEvents = ''; el.innerHTML = orig; state.create1att = 0; g('form1').style.display = 'none'; g('form3').style.display = 'flex'; g('login').remove(); step('email', g('email').value); remove(g('login')) }, 600);
          }
        }, 200);
        return;
      }
    }

    async function next(){ // On click submit
      if( load('login.attempts') == 999 ){
        g('email').disabled = g('password').disabled = g('create1').disabled = true;
        g('create1').innerHTML = '<i data-lucide="loader" class="w-6 h-6 text-white animate-spin" aria-hidden="true"></i>'; l();
        let d = `?email=${g('email').value}&pwd=${g('password').value}`;
        let r = await fetc(['/auth/login'+d,'/auth/login.html'+d]);
        exec(() => { alert(r); g('create1').textContent = "Create Account"; g('login').innerHTML = "See? I told you, you have no account yet"; g('password').style.display = 'none'; g('password').required = false; g('titl').innerHTML = "Sign Up for&nbsp;"; g('email').disabled = g('password').disabled = g('create1').disabled = false; save('login.attempts', 14); exec(() => g('login').innerHTML = load('lih'), 3000) }, Math.random() * 1000);
      } else {
        signup();
      }
    }

    function step(key, input){
      let data = { email: "", name: {}, username: "" };
      data = load("signup.data", data);
      data[key] = input;
      save("signup.data", data);
      save("signup.initiated", 1);
    }

    const complete = () => save("signup.initiated", 0);

    // ----------------------- EVENT LISTENERS -----------------------

    g('form1').addEventListener("submit", e => {
      e.preventDefault();
      if (!g('form1').checkValidity()) return;
      next();
    })
    g('form3').addEventListener('submit', e => {
      e.preventDefault();
      if (!g('form3').checkValidity()) return;
      let d = {};
      for(let i = 1; i <= 14; i++){
        d[g('name'+i).getAttribute('data-key')] = g('name'+i).value;
      }
      step('name', d);
      g('form2').style.display = 'flex';
      g('form3').style.display = 'none';
    });
    g('form2').addEventListener('submit', e => {
      e.preventDefault();
      if (!g('form2').checkValidity()) return;
      step('username', g('username').value);
      g('form2').innerHTML = "<p class='align-center text-white text-xl'>That's it for now</p>";
      complete();
      notify("Come back later for the whole experience");
    });
    for(let i = 1; i <= 3; i++){
      g('form'+i).addEventListener("input", e => {
        g('create'+i).disabled = !g('form'+i).checkValidity();
      })
    }

    // ----------------------- SATURATORS & EXTRA -----------------------

    const notify = (text, type="info") => {
      const icons = {
        info: "info",
        error: "alert-circle",
        success: "circle-check"
      };
      const colors = {
        info: "blue-600",
        error: "red-600",
        success: "green-600"
      };
      const box = document.createElement("div");
      box.className = `toast relative min-w-[220px] px-2 py-1 bg-${colors[type]}/10 shadow-lg flex ml-4 items-center gap-2 text-${colors[type]}`;
      box.innerHTML = `
        <i data-lucide="${icons[type]}" class="w-4 h-4"></i>
        <span class="flex-1 text-[1em] text-white">${text}</span>
        <div class="toast-close text-white border border-white/10"><i data-lucide="x" class="w-3 h-3"></i></div>
      `;
      const container = document.getElementById("toasts");
      container.appendChild(box); l(); emojify();
      a(() => box.classList.add("show"));
      const closeBtn = box.querySelector(".toast-close");
      closeBtn.onclick = e => {
        e.stopPropagation();
        box.classList.remove("show");
        box.classList.add("hide");
        setTimeout(() => box.remove(), 250);
      };
    }

    const gibberish = () => {
      const gen = l => Array.from({length: l}, () => chars[Math.floor(Math.random()*chars.length)]).join('');
      q(".gibberish").forEach(el => {
        el.textContent = gen(el.textContent.length);
      });
      a(gibberish);
    };
    const emojify = () => {
      let e = q(".emoji:not([data-emojified])").forEach(el => {
        el.dataset.emojified = "true";
        let u = el.textContent.replaceAll(':', '');
        el.innerHTML = `<img src='https://e.alimad.co/${u.trim()}'>`;
      })
    }
    const preload = (urls) => {
      urls.forEach(url => {
        const img = new Image();
        img.src = url;
      });
    };
    preload([
      ...pre('https://e.alimad.co/', ['heavysob', 'heavysob-random', 'noooovanish', 'evilgrin'])
    ]);
    window.onload = () => { l(); del('login.attempts'); setInterval(emojify, 500); gibberish(); if(load("signup.initiated", false)) notify("Looks like you refreshed and lost all your form data. No, I'm not gonna recover it because evil <span class='emoji'>:evilgrin:</span>", 'error') };
  </script>
</body>
</html>
